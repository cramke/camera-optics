<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="/src/styles.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Camera Optics Calculator</title>
    <script type="module" src="/src/main.ts" defer></script>
  </head>

  <body>
    <div class="app-container">
      <header>
        <div class="header-content">
          <div class="header-title">
            <h1>Camera Optics Calculator</h1>
          </div>
          <div class="header-menu">
            <button id="menu-toggle-btn" class="menu-btn">⋮</button>
            <div id="menu-dropdown" class="menu-dropdown">
              <button id="settings-btn-mobile" class="dropdown-item">Settings</button>
              <button id="about-btn-mobile" class="dropdown-item">About</button>
            </div>
          </div>
        </div>
      </header>

      <div class="main-content">
        <!-- Left Panel: Camera Systems -->
        <div class="panel systems-panel">
          <div id="systems-list" class="systems-list">
            <div class="systems-list-header">
              <h3>Comparison List</h3>
              <button id="add-new-system-btn" class="add-new-btn" title="Add new camera system">+</button>
            </div>
            <div id="systems-items"></div>
          </div>
        </div>

        <!-- Right Panel: Visualization & Results -->
        <div class="panel results-panel">
          <div class="tabs">
            <button class="tab-btn active" data-tab="camera-input">Camera Input</button>
            <button class="tab-btn" data-tab="visualization">Visualization</button>
            <button class="tab-btn" data-tab="results">Results</button>
            <button class="tab-btn" data-tab="image-preview">Image Preview</button>
            <button class="tab-btn" data-tab="dori-designer">DORI Designer</button>
          </div>

          <div id="camera-input-tab" class="tab-content active">
            <div class="camera-input-layout">
              <div class="camera-form-column">
                <div class="camera-form">
                  <div class="form-group">
                    <label for="name">Name (optional)</label>
                    <input type="text" id="name" placeholder="e.g., Full Frame 50mm" />
                  </div>

                  <div class="form-row">
                    <div class="form-group">
                      <label for="sensor-width">Sensor Width (mm)</label>
                      <input type="number" id="sensor-width" value="36" step="0.1" />
                    </div>
                    <div class="form-group">
                      <label for="sensor-height">Sensor Height (mm)</label>
                      <input type="number" id="sensor-height" value="27" step="0.1" />
                    </div>
                  </div>

                  <div class="form-row">
                    <div class="form-group">
                      <label for="pixel-width">Pixel Width</label>
                      <input type="number" id="pixel-width" value="2000" step="1" />
                    </div>
                    <div class="form-group">
                      <label for="pixel-height">Pixel Height</label>
                      <input type="number" id="pixel-height" value="1500" step="1" />
                    </div>
                  </div>

                  <div class="input-method-selector">
                    <div class="input-method active" id="focal-method" data-method="focal">
                      <div class="method-radio"></div>
                      <div class="method-content">
                        <label class="method-label">Focal Length</label>
                        <div class="form-group">
                          <input type="number" id="focal-length" value="50" step="0.1" placeholder="mm" />
                        </div>
                      </div>
                    </div>

                    <div class="input-method" id="fov-method" data-method="fov">
                      <div class="method-radio"></div>
                      <div class="method-content">
                        <label class="method-label">Field of View</label>
                        <div class="form-row">
                          <div class="form-group">
                            <label for="hfov-deg">Horizontal (°)</label>
                            <input type="number" id="hfov-deg" placeholder="e.g., 39.6" step="0.1" />
                          </div>
                          <div class="form-group">
                            <label for="vfov-deg">Vertical (°)</label>
                            <input type="number" id="vfov-deg" placeholder="e.g., 27" step="0.1" />
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="distance">Working Distance (m)</label>
                    <input type="number" id="distance" value="25" step="0.1" />
                  </div>
                </div>
              </div>

              <div class="presets-column">
                <div class="action-buttons">
                  <h3>Actions</h3>
                  <button id="save-changes-btn" class="action-btn save-btn" style="display: none;">Save Changes</button>
                  <button id="discard-changes-btn" class="action-btn discard-btn" style="display: none;">Discard Changes</button>
                  <button id="delete-system-btn" class="action-btn delete-btn" style="display: none;">Delete System</button>
                  <button id="add-system-btn" class="action-btn add-btn">Add to Comparison</button>
                  <button id="clear-form-btn" class="action-btn clear-btn">Clear Form</button>
                </div>
                
                <div class="presets">
                  <h3>Quick Presets</h3>
                  <button class="preset-btn" data-preset="full-frame">Full Frame</button>
                  <button class="preset-btn" data-preset="aps-c">APS-C</button>
                  <button class="preset-btn" data-preset="micro43">Micro 4/3</button>
                </div>
              </div>
            </div>
          </div>

          <div id="visualization-tab" class="tab-content">
            <div class="canvas-container">
              <canvas id="fov-canvas" width="600" height="600"></canvas>
              <div id="canvas-legend" class="legend"></div>
            </div>
            <div class="reference-objects">
              <label for="ref-object-select">Reference Object:</label>
              <select id="ref-object-select">
                <!-- Options populated dynamically from TypeScript -->
              </select>
            </div>
          </div>

          <div id="results-tab" class="tab-content">
            <div id="results-output"></div>
          </div>

          <div id="image-preview-tab" class="tab-content">
            <div class="preview-container">
              <div class="preview-controls">
                <div class="form-row">
                  <div class="form-group">
                    <label for="preview-upload">Upload Image</label>
                    <input type="file" id="preview-upload" accept="image/*" />
                  </div>
                  <div class="form-group">
                    <label for="preview-image-width">Image Real-World Width (m)</label>
                    <input type="number" id="preview-image-width" value="1" min="0.01" max="1000" step="0.1" />
                  </div>
                </div>
                <div class="form-group">
                  <label for="preview-distance-slider">Working Distance: <span id="preview-distance-value">25</span> m</label>
                  <input type="range" id="preview-distance-slider" min="1" max="25000" step="1" class="distance-slider" />
                </div>
                <div class="form-group">
                  <label>Resolution</label>
                  <div id="preview-resolution" class="info-display">-</div>
                </div>
              </div>
              <div class="preview-images">
                <div class="preview-image-box">
                  <h4>Original Image</h4>
                  <canvas id="original-canvas"></canvas>
                </div>
                <div class="preview-image-box">
                  <h4>Camera View (at <span id="preview-distance-label">25</span>m)</h4>
                  <canvas id="preview-canvas"></canvas>
                  <div class="preview-info">
                    <div id="preview-stats"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div id="dori-designer-tab" class="tab-content">
            <div class="dori-designer-content">
              <div class="designer-section">
                <h3>Target DORI Distances (m)</h3>
                
                <div class="dori-grid">
                  <div class="dori-input-group">
                    <label for="target-detection">Detection <span class="dori-spec">(25 px/m)</span></label>
                    <input type="number" id="target-detection" placeholder="50" step="0.1" />
                  </div>
                  
                  <div class="dori-input-group">
                    <label for="target-observation">Observation <span class="dori-spec">(62.5 px/m)</span></label>
                    <input type="number" id="target-observation" placeholder="20" step="0.1" />
                  </div>
                  
                  <div class="dori-input-group">
                    <label for="target-recognition">Recognition <span class="dori-spec">(125 px/m)</span></label>
                    <input type="number" id="target-recognition" placeholder="10" step="0.1" />
                  </div>
                  
                  <div class="dori-input-group">
                    <label for="target-identification">Identification <span class="dori-spec">(250 px/m)</span></label>
                    <input type="number" id="target-identification" placeholder="5" step="0.1" />
                  </div>
                </div>
              </div>

              <div class="designer-section">
                <h3>Camera Parameters</h3>
                <p class="section-description">Enter a value to fix it, or leave empty to see calculated range</p>
                
                <div class="param-row">
                  <div class="param-group" data-param="sensor-width">
                    <div class="param-header">
                      <label class="param-label">Sensor Width (mm)</label>
                      <div id="range-sensor-width" class="param-range-inline"></div>
                    </div>
                    <div class="param-mode-control">
                      <button class="mode-btn active" data-mode="float">Float</button>
                      <button class="mode-btn" data-mode="fixed">Fixed</button>
                      <button class="mode-btn" data-mode="range">Range</button>
                    </div>
                    <div class="param-input-container">
                      <div class="param-input-wrapper mode-fixed" style="display: none;">
                        <input type="number" id="fixed-sensor-width" class="param-input" placeholder="Enter value" step="0.1" />
                      </div>
                      <div class="param-range-inputs mode-range" style="display: none;">
                        <input type="number" id="min-sensor-width" class="param-range-input" placeholder="Min" step="0.1" />
                        <span class="range-separator">–</span>
                        <input type="number" id="max-sensor-width" class="param-range-input" placeholder="Max" step="0.1" />
                      </div>
                    </div>
                  </div>
                  
                  <div class="param-group" data-param="pixel-width">
                    <div class="param-header">
                      <label class="param-label">Pixel Width</label>
                      <div id="range-pixel-width" class="param-range-inline"></div>
                    </div>
                    <div class="param-mode-control">
                      <button class="mode-btn active" data-mode="float">Float</button>
                      <button class="mode-btn" data-mode="fixed">Fixed</button>
                      <button class="mode-btn" data-mode="range">Range</button>
                    </div>
                    <div class="param-input-container">
                      <div class="param-input-wrapper mode-fixed" style="display: none;">
                        <input type="number" id="fixed-pixel-width" class="param-input" placeholder="Enter value" step="1" />
                      </div>
                      <div class="param-range-inputs mode-range" style="display: none;">
                        <input type="number" id="min-pixel-width" class="param-range-input" placeholder="Min" step="1" />
                        <span class="range-separator">–</span>
                        <input type="number" id="max-pixel-width" class="param-range-input" placeholder="Max" step="1" />
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="param-row">
                  <div class="param-group" data-param="focal-length">
                    <div class="param-header">
                      <label class="param-label">Focal Length (mm)</label>
                      <div id="range-focal-length" class="param-range-inline"></div>
                    </div>
                    <div class="param-mode-control">
                      <button class="mode-btn active" data-mode="float">Float</button>
                      <button class="mode-btn" data-mode="fixed">Fixed</button>
                      <button class="mode-btn" data-mode="range">Range</button>
                    </div>
                    <div class="param-input-container">
                      <div class="param-input-wrapper mode-fixed" style="display: none;">
                        <input type="number" id="fixed-focal-length" class="param-input" placeholder="Enter value" step="0.1" />
                      </div>
                      <div class="param-range-inputs mode-range" style="display: none;">
                        <input type="number" id="min-focal-length" class="param-range-input" placeholder="Min" step="0.1" />
                        <span class="range-separator">–</span>
                        <input type="number" id="max-focal-length" class="param-range-input" placeholder="Max" step="0.1" />
                      </div>
                    </div>
                  </div>
                  
                  <div class="param-group" data-param="horizontal-fov">
                    <div class="param-header">
                      <label class="param-label">Horizontal FOV (°)</label>
                      <div id="range-horizontal-fov" class="param-range-inline"></div>
                    </div>
                    <div class="param-mode-control">
                      <button class="mode-btn active" data-mode="float">Float</button>
                      <button class="mode-btn" data-mode="fixed">Fixed</button>
                      <button class="mode-btn" data-mode="range">Range</button>
                    </div>
                    <div class="param-input-container">
                      <div class="param-input-wrapper mode-fixed" style="display: none;">
                        <input type="number" id="fixed-horizontal-fov" class="param-input" placeholder="Enter value" step="0.1" />
                      </div>
                      <div class="param-range-inputs mode-range" style="display: none;">
                        <input type="number" id="min-horizontal-fov" class="param-range-input" placeholder="Min" step="0.1" />
                        <span class="range-separator">–</span>
                        <input type="number" id="max-horizontal-fov" class="param-range-input" placeholder="Max" step="0.1" />
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="param-row">
                  <div class="param-group" data-param="sensor-height">
                    <div class="param-header">
                      <label class="param-label">Sensor Height (mm)</label>
                      <div id="range-sensor-height" class="param-range-inline"></div>
                    </div>
                    <div class="param-mode-control">
                      <button class="mode-btn active" data-mode="float">Float</button>
                      <button class="mode-btn" data-mode="fixed">Fixed</button>
                      <button class="mode-btn" data-mode="range">Range</button>
                    </div>
                    <div class="param-input-container">
                      <div class="param-input-wrapper mode-fixed" style="display: none;">
                        <input type="number" id="fixed-sensor-height" class="param-input" placeholder="Enter value" step="0.1" />
                      </div>
                      <div class="param-range-inputs mode-range" style="display: none;">
                        <input type="number" id="min-sensor-height" class="param-range-input" placeholder="Min" step="0.1" />
                        <span class="range-separator">–</span>
                        <input type="number" id="max-sensor-height" class="param-range-input" placeholder="Max" step="0.1" />
                      </div>
                    </div>
                  </div>
                  
                  <div class="param-group" data-param="pixel-height">
                    <div class="param-header">
                      <label class="param-label">Pixel Height</label>
                      <div id="range-pixel-height" class="param-range-inline"></div>
                    </div>
                    <div class="param-mode-control">
                      <button class="mode-btn active" data-mode="float">Float</button>
                      <button class="mode-btn" data-mode="fixed">Fixed</button>
                      <button class="mode-btn" data-mode="range">Range</button>
                    </div>
                    <div class="param-input-container">
                      <div class="param-input-wrapper mode-fixed" style="display: none;">
                        <input type="number" id="fixed-pixel-height" class="param-input" placeholder="Enter value" step="1" />
                      </div>
                      <div class="param-range-inputs mode-range" style="display: none;">
                        <input type="number" id="min-pixel-height" class="param-range-input" placeholder="Min" step="1" />
                        <span class="range-separator">–</span>
                        <input type="number" id="max-pixel-height" class="param-range-input" placeholder="Max" step="1" />
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="button-row">
                <button id="reset-dori-designer-btn" class="secondary-btn">Reset All</button>
                <button id="export-to-comparison-btn" class="primary-btn" style="display: none;">Add to Comparison</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast notification container -->
    <div id="toast-container"></div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Settings</h2>
          <button class="modal-close" id="settings-close">&times;</button>
        </div>
        <div class="modal-body">
          <div class="setting-group">
            <h3>Experimental Features</h3>
            <label class="checkbox-label">
              <input type="checkbox" id="enable-experimental" />
              <span>Enable experimental features (Image Preview & DORI Designer)</span>
            </label>
            <p class="setting-description">These features are in development and may not work as expected.</p>
          </div>
        </div>
        <div class="modal-footer">
          <button id="settings-save" class="primary-btn">Save & Reload</button>
        </div>
      </div>
    </div>

    <!-- About Modal -->
    <div id="about-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>About</h2>
          <button class="modal-close" id="about-close">&times;</button>
        </div>
        <div class="modal-body">
          <h3>Camera Optics Calculator</h3>
          <p><strong>Version:</strong> 0.1.0</p>
          <p>Calculate field of view and spatial resolution for camera systems.</p>
          <br>
          <p><strong>Features:</strong></p>
          <ul>
            <li>FOV calculation and visualization</li>
            <li>Multi-camera comparison</li>
            <li>DORI distance analysis</li>
            <li>Reference object overlays</li>
          </ul>
        </div>
      </div>
    </div>
  </body>
</html>
